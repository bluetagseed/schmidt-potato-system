<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pallet Packing Label Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsbarcode/3.11.0/JsBarcode.all.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #ff9800 0%, #ffeb3b 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #ff9800 0%, #ffeb3b 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .content {
            padding: 40px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #ff9800;
            box-shadow: 0 0 0 3px rgba(255, 152, 0, 0.1);
        }
        
        input[readonly] {
            background: #f5f5f5;
            color: #666;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            margin: 10px 0;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #ff9800 0%, #ffeb3b 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(255, 152, 0, 0.3);
        }
        
        .btn-secondary {
            background: #f5f5f5;
            color: #333;
        }
        
        .label-preview {
            background: #fff9e6;
            border: 3px solid #ff9800;
            border-radius: 12px;
            padding: 30px;
            margin-top: 30px;
            text-align: center;
        }
        
        .label-preview h2 {
            color: #ff9800;
            margin-bottom: 20px;
        }
        
        #barcode {
            margin: 20px auto;
        }
        
        .label-details {
            background: white;
            border: 2px solid #ff9800;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            text-align: left;
        }
        
        .label-details p {
            margin: 10px 0;
            font-size: 1.1em;
        }
        
        .label-details strong {
            color: #ff9800;
        }
        
        @media print {
            body {
                background: white;
                padding: 0;
            }
            .container {
                box-shadow: none;
                border-radius: 0;
            }
            .header {
                background: white;
                color: black;
            }
            .btn, .no-print {
                display: none !important;
            }
        }
        
        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üì¶ Pallet Packing Label Generator</h1>
            <p>Schmidt Potato - Internal Packing Labels</p>
        </div>
        
        <div class="content">
            <form id="labelForm">
                <div class="form-group">
                    <label for="palletId">Pallet ID (Auto-Generated)</label>
                    <input type="text" id="palletId" readonly>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="variety">Variety *</label>
                        <select id="variety" name="variety" required onchange="handleVarietyChange()">
                            <option value="">Select Variety</option>
                            <option value="Russet Burbank">Russet Burbank</option>
                            <option value="Red Pontiac">Red Pontiac</option>
                            <option value="Yukon Gold">Yukon Gold</option>
                            <option value="Kennebec">Kennebec</option>
                            <option value="other">‚ûï Add Other Variety...</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="packWeight">Pack Weight *</label>
                        <select id="packWeight" name="packWeight" onchange="updateBagCount()" required>
                            <option value="3">3 LBS</option>
                            <option value="4">4 LBS</option>
                            <option value="5">5 LBS</option>
                            <option value="10">10 LBS</option>
                            <option value="25">25 LBS</option>
                            <option value="50" selected>50 LBS</option>
                            <option value="50">5/10 = 50 LBS</option>
                            <option value="50">10/5 = 50 LBS</option>
                            <option value="100">100 LBS</option>
                            <option value="bulk">Bulk Pack</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group" id="customVarietyGroup" style="display: none;">
                    <label>Enter New Variety *</label>
                    <input type="text" id="customVariety" placeholder="Type new variety name">
                    <button type="button" class="btn-secondary" onclick="saveCustomVariety()">üíæ Save Variety</button>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="grade">Grade *</label>
                        <input type="text" id="grade" placeholder="e.g., Blue Tag Size A" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="bagCount">Bag Count *</label>
                        <input type="number" id="bagCount" min="1" placeholder="e.g., 40" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="packDate">Pack Date *</label>
                        <input type="date" id="packDate" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="lotCode">Lot Code *</label>
                        <input type="text" id="lotCode" placeholder="e.g., LOT-2024-001" required>
                    </div>
                </div>
                
                <button type="button" class="btn btn-primary" onclick="generateLabel()">üè∑Ô∏è Generate Label</button>
                <button type="button" class="btn btn-secondary" onclick="window.location.href='dashboard.html'">üè† Back Home</button>
            </form>
            
            <div class="label-preview" id="labelPreview" style="display: none;">
                <h2>üìã Label Preview</h2>
                <svg id="barcode"></svg>
                <div class="label-details" id="labelDetails"></div>
                <button type="button" class="btn btn-primary" onclick="window.print()">üñ®Ô∏è Print Label</button>
                <button type="button" class="btn btn-secondary" onclick="resetForm()">üîÑ Generate Another</button>
            </div>
        </div>
    </div>

    <script>
        let palletCounter = parseInt(localStorage.getItem('palletCounter')) || 1;
        
        // Load custom varieties from localStorage
        function loadCustomVarieties() {
            const customVarieties = JSON.parse(localStorage.getItem('customVarieties') || '[]');
            const varietySelect = document.getElementById('variety');
            const otherOption = varietySelect.querySelector('option[value="other"]');
            
            // Add custom varieties before "Other" option
            customVarieties.forEach(variety => {
                const option = document.createElement('option');
                option.value = variety;
                option.textContent = variety;
                varietySelect.insertBefore(option, otherOption);
            });
        }
        
        // Handle variety selection change
        function handleVarietyChange() {
            const varietySelect = document.getElementById('variety');
            const customGroup = document.getElementById('customVarietyGroup');
            
            if (varietySelect.value === 'other') {
                customGroup.style.display = 'block';
                document.getElementById('customVariety').focus();
            } else {
                customGroup.style.display = 'none';
            }
        }
        
        // Save custom variety
        function saveCustomVariety() {
            const customVariety = document.getElementById('customVariety').value.trim();
            
            if (!customVariety) {
                alert('Please enter a variety name');
                return;
            }
            
            // Get existing custom varieties
            const customVarieties = JSON.parse(localStorage.getItem('customVarieties') || '[]');
            
            // Check if already exists
            if (customVarieties.includes(customVariety)) {
                alert('This variety already exists!');
                return;
            }
            
            // Add new variety
            customVarieties.push(customVariety);
            localStorage.setItem('customVarieties', JSON.stringify(customVarieties));
            
            // Add to dropdown
            const varietySelect = document.getElementById('variety');
            const otherOption = varietySelect.querySelector('option[value="other"]');
            const newOption = document.createElement('option');
            newOption.value = customVariety;
            newOption.textContent = customVariety;
            varietySelect.insertBefore(newOption, otherOption);
            
            // Select the new variety
            varietySelect.value = customVariety;
            
            // Hide custom input
            document.getElementById('customVarietyGroup').style.display = 'none';
            document.getElementById('customVariety').value = '';
            
            alert('‚úÖ Variety "' + customVariety + '" saved!');
        }
        
        function init() {
            loadCustomVarieties();
            updatePalletID();
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('packDate').value = today;
            loadLotCode();
            updateBagCount();
        }
        
        function loadLotCode() {
            const lotCode = localStorage.getItem('lastLotCode') || localStorage.getItem('lotCode') || '';
            const lotCodeField = document.getElementById('lotCode');
            lotCodeField.value = lotCode;
            lotCodeField.readOnly = true;
        }
        
        function updateBagCount() {
            const weight = document.getElementById('packWeight').value;
            const bagCountField = document.getElementById('bagCount');
            
            // Bag counts per pallet based on pack weight
            // Note: 3 LBS targets 1800 lbs (pallet weight constraint), others target 2000 lbs
            // Note: All 50 LBS options (50, 5/10=50, 10/5=50) intentionally use same value
            const bagCounts = {
                '3': 600,    // 1800 lbs total (pallet weight limit)
                '4': 500,    // 2000 lbs total
                '5': 400,    // 2000 lbs total
                '10': 200,   // 2000 lbs total
                '25': 80,    // 2000 lbs total
                '50': 40,    // 2000 lbs total (5 bags/layer √ó 8 layers)
                '100': 20,   // 2000 lbs total
                'bulk': 0    // TBD - awaiting specification
            };
            
            bagCountField.value = bagCounts[weight] || 0;
            bagCountField.readOnly = true;
        }
        
        function updatePalletID() {
            document.getElementById('palletId').value = 'P-' + String(palletCounter).padStart(4, '0');
        }
        
        function generateLabel() {
            const palletId = document.getElementById('palletId').value;
            const variety = document.getElementById('variety').value;
            const packWeight = document.getElementById('packWeight').value;
            const grade = document.getElementById('grade').value.trim();
            const bagCount = document.getElementById('bagCount').value;
            const packDate = document.getElementById('packDate').value;
            const lotCode = document.getElementById('lotCode').value.trim();
            
            if (!grade || !bagCount || !packDate || !lotCode) {
                alert('‚ö†Ô∏è Please fill in all required fields!');
                return;
            }
            
            try {
                JsBarcode("#barcode", palletId, {
                    format: "CODE128",
                    width: 2,
                    height: 80,
                    displayValue: true,
                    fontSize: 20,
                    margin: 10
                });
            } catch (e) {
                alert('‚ùå Error generating barcode: ' + e.message);
                return;
            }
            
            const labelDetails = `
                <p><strong>Pallet ID:</strong> ${palletId}</p>
                <p><strong>Variety:</strong> ${variety}</p>
                <p><strong>Pack Weight:</strong> ${packWeight === 'bulk' ? 'Bulk Pack' : packWeight + ' LBS'}</p>
                <p><strong>Grade:</strong> ${grade}</p>
                <p><strong>Bag Count:</strong> ${bagCount} bags</p>
                <p><strong>Pack Date:</strong> ${packDate}</p>
                <p><strong>Lot Code:</strong> ${lotCode}</p>
            `;
            
            document.getElementById('labelDetails').innerHTML = labelDetails;
            document.getElementById('labelPreview').style.display = 'block';
            
            palletCounter++;
            localStorage.setItem('palletCounter', palletCounter);
            updatePalletID();
            
            document.getElementById('labelPreview').scrollIntoView({ behavior: 'smooth' });
        }
        
        function resetForm() {
            document.getElementById('labelForm').reset();
            document.getElementById('labelPreview').style.display = 'none';
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('packDate').value = today;
            updatePalletID();
        }
        
        init();
    </script>
</body>
</html>