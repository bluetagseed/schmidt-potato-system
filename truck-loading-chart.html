<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Truck Loading System - Schmidt Potato</title>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            padding: 30px;
        }

        .main-header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            text-align: center;
            padding: 30px 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .main-header h1 {
            color: white;
            margin-bottom: 10px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        .main-header p {
            color: rgba(255, 255, 255, 0.95);
            font-size: 1.1em;
            margin: 0;
        }

        h1 {
            color: #1e3c72;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.2em;
        }

        h2 {
            color: #2a5298;
            margin-top: 25px;
            margin-bottom: 15px;
            font-size: 1.6em;
            font-weight: 700;
        }

        .section-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            padding: 25px;
            margin-bottom: 20px;
        }

        .section-title {
            color: #1e3c72;
            font-size: 1.3em;
            font-weight: 700;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        h3 {
            color: #1e3c72;
            margin-top: 20px;
            margin-bottom: 12px;
            font-size: 1.2em;
        }

        .screen {
            display: none;
        }

        .screen.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 0.95em;
        }

        input[type="text"],
        input[type="number"],
        input[type="tel"],
        select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        input:focus,
        select:focus {
            outline: none;
            border-color: #2a5298;
            box-shadow: 0 0 0 3px rgba(42, 82, 152, 0.1);
        }

        input::placeholder {
            color: #999;
            font-style: italic;
        }

        button {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.2s;
            margin: 5px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(30, 60, 114, 0.3);
        }

        button:active {
            transform: translateY(0);
        }

        button.secondary {
            background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);
        }

        button.danger {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        }

        button.success {
            background: linear-gradient(135deg, #28a745 0%, #218838 100%);
        }

        .back-button-container {
            margin-bottom: 20px;
        }

        .back-button {
            display: inline-block;
            background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);
            color: white;
            text-decoration: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            transition: all 0.2s;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            cursor: pointer;
        }

        .back-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(108, 117, 125, 0.3);
        }

        .back-button:active {
            transform: translateY(0);
        }

        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 15px 0;
        }

        .row-config-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            margin: 20px 0;
            border: 2px solid #e0e0e0;
        }

        .row-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 15px 0;
        }

        .row-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: white;
            padding: 12px;
            border-radius: 6px;
            border: 2px solid #ddd;
        }

        .row-item span {
            font-weight: 600;
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
            margin: 0 8px;
        }

        .badge.single {
            background: #17a2b8;
            color: white;
        }

        .badge.double {
            background: #ffc107;
            color: #333;
        }

        .row-counter {
            font-size: 1.3em;
            font-weight: 700;
            color: #1e3c72;
            text-align: center;
            padding: 20px;
            background: white;
            border-radius: 8px;
            margin: 15px 0;
            border: 2px solid #2a5298;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .truck-info-header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 25px;
        }

        .truck-info-header h3 {
            color: white;
            margin-top: 0;
        }

        .truck-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .info-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 6px;
        }

        .info-label {
            font-size: 0.85em;
            opacity: 0.9;
            margin-bottom: 4px;
        }

        .info-value {
            font-size: 1.1em;
            font-weight: 600;
        }

        .stats-dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 25px 0;
        }

        .stat-box {
            background: linear-gradient(135deg, #e9ecef 0%, #f8f9fa 100%);
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            border: 2px solid #dee2e6;
        }

        .stat-label {
            font-size: 0.9em;
            color: #6c757d;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 2em;
            font-weight: 700;
            color: #1e3c72;
        }

        .scan-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 8px;
            margin: 25px 0;
        }

        .scan-input-wrapper {
            position: relative;
            margin-bottom: 20px;
        }

        .scan-input {
            width: 100%;
            padding: 18px;
            font-size: 1.3em;
            border: 3px solid #2a5298;
            border-radius: 8px;
            text-align: center;
        }

        .scan-result {
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            font-weight: 600;
            text-align: center;
        }

        .scan-result.success {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }

        .scan-result.error {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }

        .scan-result.warning {
            background: #fff3cd;
            color: #856404;
            border: 2px solid #ffeeba;
        }

        .pallet-prompts {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .truck-diagram {
            margin: 30px 0;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 12px;
            border: 3px solid #2a5298;
        }

        .truck-labels {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            font-weight: 700;
            color: #1e3c72;
            font-size: 1.1em;
        }

        .truck-grid {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .truck-row {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .pallet-spot {
            flex: 1;
            max-width: 200px;
            min-width: 120px;
            height: 100px;
            border: 3px solid #6c757d;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.85em;
            padding: 8px;
            background: #e9ecef;
        }

        .pallet-spot.empty {
            background: #e9ecef;
            border-color: #adb5bd;
        }

        .pallet-spot.empty:hover {
            background: #dee2e6;
            border-color: #6c757d;
            transform: scale(1.05);
        }

        .pallet-spot.filled {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            border-color: #28a745;
            cursor: default;
        }

        .pallet-spot.selected {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeeba 100%);
            border-color: #ffc107;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }

        .pallet-id {
            font-weight: 700;
            color: #1e3c72;
            margin-bottom: 4px;
        }

        .pallet-details {
            font-size: 0.8em;
            text-align: center;
            line-height: 1.3;
        }

        .position-label {
            font-size: 0.75em;
            color: #6c757d;
            font-weight: 600;
        }

        .pallet-summary-list {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 25px 0;
        }

        .pallet-summary-item {
            background: white;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #28a745;
            margin-bottom: 12px;
        }

        .pallet-summary-header {
            font-weight: 700;
            color: #1e3c72;
            margin-bottom: 8px;
            font-size: 1.05em;
        }

        .pallet-summary-details {
            color: #6c757d;
            line-height: 1.6;
        }

        .barcode-container {
            text-align: center;
            margin: 25px 0;
            padding: 20px;
            background: white;
            border-radius: 8px;
        }

        .alert {
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            font-weight: 600;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 2px solid #bee5eb;
        }

        .legend {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-box {
            width: 30px;
            height: 30px;
            border-radius: 4px;
            border: 2px solid #333;
        }

        .legend-box.empty {
            background: #e9ecef;
        }

        .legend-box.filled {
            background: #d4edda;
        }

        .legend-box.selected {
            background: #fff3cd;
        }

        @media print {
            body {
                background: white;
                padding: 0;
            }

            .container {
                box-shadow: none;
                max-width: 100%;
                padding: 20px;
            }

            button {
                display: none;
            }

            .scan-section {
                display: none;
            }

            .truck-diagram {
                page-break-inside: avoid;
            }

            .pallet-spot {
                border: 2px solid #333;
                print-color-adjust: exact;
                -webkit-print-color-adjust: exact;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            h1 {
                font-size: 1.6em;
            }

            h2 {
                font-size: 1.3em;
            }

            .btn-group {
                flex-direction: column;
            }

            button {
                width: 100%;
            }

            .pallet-spot {
                min-width: 80px;
                height: 80px;
                font-size: 0.75em;
            }

            .stats-dashboard {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- SCREEN 1: SETUP CONFIGURATION -->
        <div id="setupScreen" class="screen active">
            <div class="main-header">
                <h1>üöõ Truck Loading Chart</h1>
                <p>Schmidt Potato - Live Loading Tracker</p>
            </div>

            <!-- Back to Dashboard Button -->
            <div class="back-button-container">
                <a href="dashboard.html" class="back-button">üè† Back to Dashboard</a>
            </div>

            <!-- Section 2: Customer Selection -->
            <div class="section-card">
                <div class="section-title">üë§ Select or Add Customer</div>
                <div class="form-group">
                    <select id="customerSelect">
                        <option value="">-- Select Saved Customer or Create New --</option>
                    </select>
                </div>
                <div class="btn-group">
                    <button onclick="saveCustomer()">üíæ Save</button>
                    <button onclick="deleteCustomer()" class="danger">üóëÔ∏è Delete</button>
                    <button onclick="newCustomer()" class="secondary">‚ûï New</button>
                </div>
            </div>

            <!-- Customer Name field - standalone between cards -->
            <div class="form-group">
                <label>Customer Name *</label>
                <input type="text" id="customerName" placeholder="e.g., ABC Company">
            </div>

            <!-- Section 3: Truck & Customer Information -->
            <div class="section-card">
                <div class="section-title">Truck &amp; Customer Information</div>
                
                <!-- Truck Selection moved here at the top of the card -->
                <div class="form-group">
                    <select id="truckSelect">
                        <option value="">-- Select Saved Truck or Create New --</option>
                    </select>
                </div>
                <div class="btn-group">
                    <button onclick="saveTruck()">üíæ Save</button>
                    <button onclick="deleteTruck()" class="danger">üóëÔ∏è Delete</button>
                    <button onclick="newTruck()" class="secondary">‚ûï New</button>
                </div>
                
                <div class="form-group">
                    <label>Truck Name/Description *</label>
                    <input type="text" id="truckName" placeholder="e.g., Blue Freightliner">
                </div>

                <div class="form-group">
                    <label>Truck Number *</label>
                    <input type="text" id="truckNumber" placeholder="e.g., #101">
                </div>

              

                <div class="form-group">
                    <label>Default Driver Name</label>
                    <input type="text" id="driverName" placeholder="e.g., John Smith">
                </div>

                <div class="form-group">
                    <label>Default Driver Phone</label>
                    <input type="tel" id="driverPhone" placeholder="e.g., (701) 555-1234">
                </div>
            </div>

            <!-- Section 4: Row Configuration -->
            <div class="section-card">
                <div class="section-title">üìê Loading Configuration - <span id="rowCountDisplay">0</span>/13 Rows</div>
                
                <div class="form-group">
                    <label>Quick Setup:</label>
                    <select id="quickSetup" onchange="applyQuickSetup()">
                        <option value="">-- Select Number of Rows --</option>
                        <option value="1-double">1 Row (Double-Wide)</option>
                        <option value="2-double">2 Rows (Double-Wide)</option>
                        <option value="3-double">3 Rows (Double-Wide)</option>
                        <option value="4-double">4 Rows (Double-Wide)</option>
                        <option value="5-double">5 Rows (Double-Wide)</option>
                        <option value="6-double">6 Rows (Double-Wide)</option>
                        <option value="7-double">7 Rows (Double-Wide)</option>
                        <option value="8-double">8 Rows (Double-Wide)</option>
                        <option value="9-double">9 Rows (Double-Wide)</option>
                        <option value="10-double">10 Rows (Double-Wide)</option>
                        <option value="11-double">11 Rows (Double-Wide)</option>
                        <option value="12-double">12 Rows (Double-Wide)</option>
                        <option value="13-double">13 Rows (Double-Wide)</option>
                        <option value="custom">Custom</option>
                    </select>
                </div>

                <div class="row-counter" id="rowCounter">0/13 Rows Configured</div>

                <div class="row-list" id="rowList">
                    <div class="alert alert-info" id="emptyRowMessage">
                        No rows configured. Select dropdown above or click "Add Row" to start from Row 1.
                    </div>
                </div>

                <div class="btn-group">
                    <button onclick="addRow()">‚ûï Add Row 1</button>
                    <button onclick="clearRows()" class="danger">üóëÔ∏è Clear All Rows</button>
                </div>
            </div>

            <div class="btn-group" style="margin-top: 30px; justify-content: center;">
                <button onclick="proceedToLoading()" class="success" style="font-size: 1.3em; padding: 16px 40px;">
                    üöÄ Start Loading
                </button>
            </div>
        </div>

        <!-- SCREEN 2: LOADING SCREEN -->
        <div id="loadingScreen" class="screen">
            <div class="main-header">
                <h1>üöõ Truck Loading Chart</h1>
                <p>Schmidt Potato - Live Loading Tracker</p>
            </div>

            <!-- Truck Info Header -->
            <div class="truck-info-header">
                <h3>Truck Information</h3>
                <div class="truck-info-grid">
                    <div class="info-item">
                        <div class="info-label">Truck Name:</div>
                        <div class="info-value" id="displayTruckName">-</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Truck Number:</div>
                        <div class="info-value" id="displayTruckNumber">-</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Driver Name:</div>
                        <div class="info-value" id="displayDriverName">-</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Driver Phone:</div>
                        <div class="info-value" id="displayDriverPhone">-</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Customer:</div>
                        <div class="info-value" id="displayCustomerName">-</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Date & Time:</div>
                        <div class="info-value" id="displayDateTime">-</div>
                    </div>
                </div>
                <div class="form-group" style="margin-top: 15px;">
                    <label style="color: white;">Customer PO#:</label>
                    <input type="text" id="customerPO" placeholder="Enter Customer PO#" onchange="generatePOBarcode()">
                </div>
                <div id="poBarcode" class="barcode-container" style="background: white; margin-top: 15px; display: none;">
                    <svg id="poBarcodeSVG"></svg>
                </div>
            </div>

            <!-- Statistics Dashboard -->
            <div class="stats-dashboard">
                <div class="stat-box">
                    <div class="stat-label">Loaded</div>
                    <div class="stat-value" id="statLoaded">0</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Total Capacity</div>
                    <div class="stat-value" id="statCapacity">0</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Empty Spots</div>
                    <div class="stat-value" id="statEmpty">0</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Total Weight (LBS)</div>
                    <div class="stat-value" id="statWeight">0</div>
                </div>
            </div>

            <!-- Barcode Scanning Section -->
            <div class="scan-section">
                <h3>üì¶ Scan Pallet Barcode</h3>
                <div class="scan-input-wrapper">
                    <input type="text" id="scanInput" class="scan-input" placeholder="Scan or enter pallet barcode..." autofocus>
                </div>
                <div id="scanResult" class="scan-result" style="display: none;"></div>

                <div id="palletPrompts" style="display: none;">
                    <h3>Pallet Details</h3>
                    <div class="pallet-prompts">
                        <div class="form-group">
                            <label>Variety:</label>
                            <input type="text" id="palletVariety" placeholder="e.g., Red Pontiac">
                        </div>
                        <div class="form-group">
                            <label>Weight (LBS):</label>
                            <input type="number" id="palletWeight" placeholder="e.g., 2000">
                        </div>
                        <div class="form-group">
                            <label>Grade:</label>
                            <input type="text" id="palletGrade" placeholder="e.g., Blue Tag A">
                        </div>
                        <div class="form-group">
                            <label>Bag Count:</label>
                            <input type="number" id="palletBags" placeholder="e.g., 40">
                        </div>
                    </div>
                    <div class="alert alert-info">
                        ‚ÑπÔ∏è Click on an empty spot in the truck diagram below to place this pallet.
                    </div>
                </div>
            </div>

            <!-- Visual Truck Diagram -->
            <div class="truck-diagram">
                <h3 style="text-align: center; color: #1e3c72; margin-bottom: 15px;">Truck Loading Map</h3>
                <div class="truck-labels">
                    <span>‚Üê FRONT (Cab)</span>
                    <span>BACK (Door) ‚Üí</span>
                </div>

                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-box empty"></div>
                        <span>Empty</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box filled"></div>
                        <span>Filled</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box selected"></div>
                        <span>Selected</span>
                    </div>
                </div>

                <div class="truck-grid" id="truckGrid"></div>
            </div>

            <!-- Action Buttons -->
            <div class="btn-group" style="margin-top: 30px;">
                <button onclick="goBack()" class="secondary">‚Üê Go Back</button>
                <button onclick="resetTruck()" class="danger">üîÑ Reset Truck</button>
                <button onclick="finishLoading()" class="success" style="font-size: 1.2em;">‚úÖ Finish Loading</button>
            </div>
        </div>

        <!-- SCREEN 3: COMPLETE SUMMARY -->
        <div id="completeScreen" class="screen">
            <div class="main-header">
                <h1>‚úÖ Loading Complete</h1>
                <p>Truck Loading Summary</p>
            </div>

            <!-- Truck Info Header (Summary) -->
            <div class="truck-info-header">
                <h3>Truck Information</h3>
                <div class="truck-info-grid">
                    <div class="info-item">
                        <div class="info-label">Truck Name:</div>
                        <div class="info-value" id="summaryTruckName">-</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Truck Number:</div>
                        <div class="info-value" id="summaryTruckNumber">-</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Driver Name:</div>
                        <div class="info-value" id="summaryDriverName">-</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Driver Phone:</div>
                        <div class="info-value" id="summaryDriverPhone">-</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Customer:</div>
                        <div class="info-value" id="summaryCustomerName">-</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Date & Time:</div>
                        <div class="info-value" id="summaryDateTime">-</div>
                    </div>
                </div>
                <div class="info-item" style="margin-top: 15px;">
                    <div class="info-label">Customer PO#:</div>
                    <div class="info-value" id="summaryPO">-</div>
                </div>
                <div id="summaryPOBarcode" class="barcode-container" style="display: none; background: white; margin-top: 15px;">
                    <svg id="summaryBarcodeSVG"></svg>
                </div>
            </div>

            <!-- Statistics Summary -->
            <div class="stats-dashboard">
                <div class="stat-box">
                    <div class="stat-label">Total Pallets Loaded</div>
                    <div class="stat-value" id="summaryPallets">0</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Total Weight (LBS)</div>
                    <div class="stat-value" id="summaryWeight">0</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Total Bags</div>
                    <div class="stat-value" id="summaryBags">0</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Capacity Used</div>
                    <div class="stat-value" id="summaryCapacity">0%</div>
                </div>
            </div>

            <!-- Final Truck Map -->
            <div class="truck-diagram">
                <h3 style="text-align: center; color: #1e3c72; margin-bottom: 15px;">Final Truck Loading Map</h3>
                <div class="truck-labels">
                    <span>‚Üê FRONT (Cab)</span>
                    <span>BACK (Door) ‚Üí</span>
                </div>
                <div class="truck-grid" id="summaryTruckGrid"></div>
            </div>

            <!-- Pallet Summary List -->
            <h2>Pallet Details</h2>
            <div class="pallet-summary-list" id="palletSummaryList"></div>

            <!-- Action Buttons -->
            <div class="btn-group" style="margin-top: 30px;">
                <button onclick="window.print()" class="success" style="font-size: 1.2em;">üñ®Ô∏è Print Summary</button>
                <button onclick="loadAnotherTruck()" class="secondary" style="font-size: 1.2em;">üöõ Load Another Truck</button>
            </div>
        </div>
    </div>

    <script>
        // Global State
        let truckConfig = {
            rows: []
        };
        let loadedPallets = {};
        let currentPallet = null;
        let currentDateTime = null;

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadTrucksList();
            loadCustomersList();
            updateRowDisplay();

            // Auto-focus on scan input when loading screen is shown
            document.getElementById('scanInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    scanBarcode();
                }
            });
        });

        // ========== TRUCK MANAGEMENT ==========
        function loadTrucksList() {
            const savedTrucks = JSON.parse(localStorage.getItem('savedTrucks') || '[]');
            const select = document.getElementById('truckSelect');
            select.innerHTML = '<option value="">-- Select Saved Truck or Create New --</option>';
            
            savedTrucks.forEach((truck, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = `${truck.name} (${truck.number})`;
                select.appendChild(option);
            });

            select.onchange = function() {
                if (this.value !== '') {
                    const truck = savedTrucks[this.value];
                    document.getElementById('truckName').value = truck.name;
                    document.getElementById('truckNumber').value = truck.number;
                    document.getElementById('driverName').value = truck.driverName;
                    document.getElementById('driverPhone').value = truck.driverPhone;
                    truckConfig.rows = truck.rows || [];
                    updateRowDisplay();
                }
            };
        }

        function saveTruck() {
            const name = document.getElementById('truckName').value.trim();
            const number = document.getElementById('truckNumber').value.trim();
            const driverName = document.getElementById('driverName').value.trim();
            const driverPhone = document.getElementById('driverPhone').value.trim();

            if (!name || !number) {
                alert('Please enter truck name and number');
                return;
            }

            const truck = {
                name,
                number,
                driverName,
                driverPhone,
                rows: truckConfig.rows
            };

            const savedTrucks = JSON.parse(localStorage.getItem('savedTrucks') || '[]');
            
            // Check if truck already exists
            const existingIndex = savedTrucks.findIndex(t => t.number === number);
            if (existingIndex >= 0) {
                savedTrucks[existingIndex] = truck;
            } else {
                savedTrucks.push(truck);
            }

            localStorage.setItem('savedTrucks', JSON.stringify(savedTrucks));
            loadTrucksList();
            alert('Truck saved successfully!');
        }

        function deleteTruck() {
            const select = document.getElementById('truckSelect');
            if (select.value === '') {
                alert('Please select a truck to delete');
                return;
            }

            if (!confirm('Are you sure you want to delete this truck?')) {
                return;
            }

            const savedTrucks = JSON.parse(localStorage.getItem('savedTrucks') || '[]');
            savedTrucks.splice(select.value, 1);
            localStorage.setItem('savedTrucks', JSON.stringify(savedTrucks));
            
            newTruck();
            loadTrucksList();
            alert('Truck deleted successfully!');
        }

        function newTruck() {
            document.getElementById('truckName').value = '';
            document.getElementById('truckNumber').value = '';
            document.getElementById('driverName').value = '';
            document.getElementById('driverPhone').value = '';
            document.getElementById('truckSelect').value = '';
            truckConfig.rows = [];
            updateRowDisplay();
        }

        // ========== CUSTOMER MANAGEMENT ==========
        function loadCustomersList() {
            const savedCustomers = JSON.parse(localStorage.getItem('savedCustomers') || '[]');
            const select = document.getElementById('customerSelect');
            select.innerHTML = '<option value="">-- Select Saved Customer or Create New --</option>';
            
            savedCustomers.forEach((customer, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = customer.name;
                select.appendChild(option);
            });

            select.onchange = function() {
                if (this.value !== '') {
                    const customer = savedCustomers[this.value];
                    document.getElementById('customerName').value = customer.name;
                }
            };
        }

        function saveCustomer() {
            const name = document.getElementById('customerName').value.trim();

            if (!name) {
                alert('Please enter customer name');
                return;
            }

            const customer = { name };
            const savedCustomers = JSON.parse(localStorage.getItem('savedCustomers') || '[]');
            
            // Check if customer already exists
            const existingIndex = savedCustomers.findIndex(c => c.name === name);
            if (existingIndex >= 0) {
                savedCustomers[existingIndex] = customer;
            } else {
                savedCustomers.push(customer);
            }

            localStorage.setItem('savedCustomers', JSON.stringify(savedCustomers));
            loadCustomersList();
            alert('Customer saved successfully!');
        }

        function deleteCustomer() {
            const select = document.getElementById('customerSelect');
            if (select.value === '') {
                alert('Please select a customer to delete');
                return;
            }

            if (!confirm('Are you sure you want to delete this customer?')) {
                return;
            }

            const savedCustomers = JSON.parse(localStorage.getItem('savedCustomers') || '[]');
            savedCustomers.splice(select.value, 1);
            localStorage.setItem('savedCustomers', JSON.stringify(savedCustomers));
            
            newCustomer();
            loadCustomersList();
            alert('Customer deleted successfully!');
        }

        function newCustomer() {
            document.getElementById('customerName').value = '';
            document.getElementById('customerSelect').value = '';
        }

        // ========== ROW CONFIGURATION ==========
        function applyQuickSetup() {
            const preset = document.getElementById('quickSetup').value;
            if (!preset || preset === 'custom') return;

            truckConfig.rows = [];
            const [count, type] = preset.split('-');
            const numRows = parseInt(count);
            const isDouble = type === 'double';

            for (let i = 1; i <= numRows; i++) {
                truckConfig.rows.push({
                    number: i,
                    type: isDouble ? 'double' : 'single'
                });
            }

            updateRowDisplay();
        }

        function addRow() {
            if (truckConfig.rows.length >= 13) {
                alert('Maximum 13 rows allowed');
                return;
            }

            const newRowNumber = truckConfig.rows.length + 1;
            truckConfig.rows.push({
                number: newRowNumber,
                type: 'single'
            });

            updateRowDisplay();
        }

        function toggleRowType(index) {
            const row = truckConfig.rows[index];
            row.type = row.type === 'single' ? 'double' : 'single';
            updateRowDisplay();
        }

        function removeRow(index) {
            truckConfig.rows.splice(index, 1);
            // Renumber rows
            truckConfig.rows.forEach((row, i) => {
                row.number = i + 1;
            });
            updateRowDisplay();
        }

        function clearRows() {
            if (truckConfig.rows.length === 0) return;
            if (!confirm('Clear all rows?')) return;
            truckConfig.rows = [];
            updateRowDisplay();
        }

        function updateRowDisplay() {
            const rowList = document.getElementById('rowList');
            const rowCounter = document.getElementById('rowCounter');
            const rowCountDisplay = document.getElementById('rowCountDisplay');
            const emptyMessage = document.getElementById('emptyRowMessage');
            const addRowBtn = document.querySelector('button[onclick="addRow()"]');

            // Update counter
            rowCounter.textContent = `${truckConfig.rows.length}/13 Rows Configured`;
            if (rowCountDisplay) {
                rowCountDisplay.textContent = truckConfig.rows.length;
            }

            // Update "Add Row" button text
            if (addRowBtn) {
                const nextRow = truckConfig.rows.length > 0 ? truckConfig.rows.length + 1 : 1;
                addRowBtn.innerHTML = `‚ûï Add Row ${nextRow}`;
            }

            if (truckConfig.rows.length === 0) {
                if (emptyMessage) {
                    emptyMessage.style.display = 'block';
                }
                // Remove any row items
                const existingRows = rowList.querySelectorAll('.row-item');
                existingRows.forEach(row => row.remove());
                return;
            }

            // Hide empty message
            if (emptyMessage) {
                emptyMessage.style.display = 'none';
            }

            // Build and insert row items HTML
            const rowItems = truckConfig.rows.map((row, index) => `
                <div class="row-item">
                    <span>Row ${row.number} <span class="badge ${row.type}">${row.type.toUpperCase()}</span></span>
                    <div>
                        <button onclick="toggleRowType(${index})" class="secondary" style="margin: 0 5px;">
                            ${row.type === 'single' ? '‚Üí Make Double' : '‚Üí Make Single'}
                        </button>
                        <button onclick="removeRow(${index})" class="danger" style="margin: 0;">Remove</button>
                    </div>
                </div>
            `).join('');

            // Update only the row items, keeping the empty message element
            const existingRows = rowList.querySelectorAll('.row-item');
            existingRows.forEach(row => row.remove());
            
            // Insert new row items after the empty message using insertAdjacentHTML
            if (emptyMessage) {
                emptyMessage.insertAdjacentHTML('afterend', rowItems);
            } else {
                rowList.innerHTML = rowItems;
            }
        }

        // ========== SCREEN NAVIGATION ==========
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
        }

        function proceedToLoading() {
            // Validate inputs
            const truckName = document.getElementById('truckName').value.trim();
            const truckNumber = document.getElementById('truckNumber').value.trim();
            const customerName = document.getElementById('customerName').value.trim();

            if (!truckName || !truckNumber) {
                alert('Please enter truck name and number');
                return;
            }

            if (!customerName) {
                alert('Please enter customer name');
                return;
            }

            if (truckConfig.rows.length === 0) {
                alert('Please configure at least one row');
                return;
            }

            // Set current date/time
            currentDateTime = new Date().toLocaleString();

            // Display truck info
            document.getElementById('displayTruckName').textContent = truckName;
            document.getElementById('displayTruckNumber').textContent = truckNumber;
            document.getElementById('displayDriverName').textContent = document.getElementById('driverName').value || '-';
            document.getElementById('displayDriverPhone').textContent = document.getElementById('driverPhone').value || '-';
            document.getElementById('displayCustomerName').textContent = customerName;
            document.getElementById('displayDateTime').textContent = currentDateTime;

            // Reset loading state
            loadedPallets = {};
            currentPallet = null;

            // Build truck grid
            buildTruckGrid();
            updateStats();

            showScreen('loadingScreen');
            
            // Focus on scan input
            setTimeout(() => {
                document.getElementById('scanInput').focus();
            }, 100);
        }

        function goBack() {
            const loadedCount = Object.keys(loadedPallets).length;
            if (loadedCount > 0) {
                if (!confirm(`You have ${loadedCount} pallet(s) loaded. Are you sure you want to go back? This will reset the truck.`)) {
                    return;
                }
            }
            showScreen('setupScreen');
        }

        function resetTruck() {
            if (Object.keys(loadedPallets).length === 0) {
                alert('Truck is already empty');
                return;
            }

            if (!confirm('Reset truck and remove all loaded pallets?')) {
                return;
            }

            loadedPallets = {};
            currentPallet = null;
            document.getElementById('scanInput').value = '';
            document.getElementById('scanResult').style.display = 'none';
            document.getElementById('palletPrompts').style.display = 'none';
            buildTruckGrid();
            updateStats();
            document.getElementById('scanInput').focus();
        }

        function finishLoading() {
            const loadedCount = Object.keys(loadedPallets).length;
            if (loadedCount === 0) {
                alert('No pallets loaded yet');
                return;
            }

            // Copy data to summary screen
            document.getElementById('summaryTruckName').textContent = document.getElementById('displayTruckName').textContent;
            document.getElementById('summaryTruckNumber').textContent = document.getElementById('displayTruckNumber').textContent;
            document.getElementById('summaryDriverName').textContent = document.getElementById('displayDriverName').textContent;
            document.getElementById('summaryDriverPhone').textContent = document.getElementById('displayDriverPhone').textContent;
            document.getElementById('summaryCustomerName').textContent = document.getElementById('displayCustomerName').textContent;
            document.getElementById('summaryDateTime').textContent = currentDateTime;

            const customerPO = document.getElementById('customerPO').value;
            document.getElementById('summaryPO').textContent = customerPO || '-';

            // Generate PO barcode in summary if exists
            if (customerPO) {
                document.getElementById('summaryPOBarcode').style.display = 'block';
                try {
                    JsBarcode("#summaryBarcodeSVG", customerPO, {
                        format: "CODE128",
                        width: 2,
                        height: 60,
                        displayValue: true
                    });
                } catch (e) {
                    console.error('Barcode generation error:', e);
                }
            } else {
                document.getElementById('summaryPOBarcode').style.display = 'none';
            }

            // Calculate summary statistics
            let totalWeight = 0;
            let totalBags = 0;
            const capacity = calculateTotalCapacity();

            Object.values(loadedPallets).forEach(pallet => {
                totalWeight += parseInt(pallet.weight) || 0;
                totalBags += parseInt(pallet.bags) || 0;
            });

            document.getElementById('summaryPallets').textContent = loadedCount;
            document.getElementById('summaryWeight').textContent = totalWeight.toLocaleString();
            document.getElementById('summaryBags').textContent = totalBags.toLocaleString();
            document.getElementById('summaryCapacity').textContent = Math.round((loadedCount / capacity) * 100) + '%';

            // Build summary truck grid
            buildSummaryTruckGrid();

            // Build pallet summary list
            buildPalletSummaryList();

            showScreen('completeScreen');
        }

        function loadAnotherTruck() {
            if (confirm('Load another truck? This will reset the current loading session.')) {
                showScreen('setupScreen');
                loadedPallets = {};
                currentPallet = null;
                document.getElementById('customerPO').value = '';
                document.getElementById('scanInput').value = '';
                document.getElementById('scanResult').style.display = 'none';
                document.getElementById('palletPrompts').style.display = 'none';
            }
        }

        // ========== TRUCK GRID ==========
        function buildTruckGrid() {
            const grid = document.getElementById('truckGrid');
            grid.innerHTML = '';

            truckConfig.rows.forEach(row => {
                const rowDiv = document.createElement('div');
                rowDiv.className = 'truck-row';

                if (row.type === 'single') {
                    const spot = createPalletSpot(row.number, 'CENTER');
                    rowDiv.appendChild(spot);
                } else {
                    const spotLeft = createPalletSpot(row.number, 'LEFT');
                    const spotRight = createPalletSpot(row.number, 'RIGHT');
                    rowDiv.appendChild(spotLeft);
                    rowDiv.appendChild(spotRight);
                }

                grid.appendChild(rowDiv);
            });
        }

        function createPalletSpot(rowNumber, position) {
            const spot = document.createElement('div');
            const spotId = `${rowNumber}-${position}`;
            spot.className = 'pallet-spot empty';
            spot.dataset.row = rowNumber;
            spot.dataset.position = position;
            spot.dataset.spotId = spotId;

            const pallet = loadedPallets[spotId];
            if (pallet) {
                spot.classList.remove('empty');
                spot.classList.add('filled');
                spot.innerHTML = `
                    <div class="pallet-id">${pallet.id}</div>
                    <div class="pallet-details">
                        ${pallet.variety}<br>
                        ${pallet.weight} LBS<br>
                        ${pallet.grade}<br>
                        ${pallet.bags} bags
                    </div>
                `;
            } else {
                spot.innerHTML = `
                    <div class="position-label">Row ${rowNumber}<br>${position}</div>
                    <div style="color: #adb5bd; font-size: 2em;">+</div>
                `;
                spot.onclick = function() {
                    if (currentPallet) {
                        placePallet(spotId);
                    }
                };
            }

            // Highlight if this is the selected pallet
            if (currentPallet && currentPallet.spotId === spotId) {
                spot.classList.add('selected');
            }

            return spot;
        }

        function buildSummaryTruckGrid() {
            const grid = document.getElementById('summaryTruckGrid');
            grid.innerHTML = '';

            truckConfig.rows.forEach(row => {
                const rowDiv = document.createElement('div');
                rowDiv.className = 'truck-row';

                if (row.type === 'single') {
                    const spot = createSummaryPalletSpot(row.number, 'CENTER');
                    rowDiv.appendChild(spot);
                } else {
                    const spotLeft = createSummaryPalletSpot(row.number, 'LEFT');
                    const spotRight = createSummaryPalletSpot(row.number, 'RIGHT');
                    rowDiv.appendChild(spotLeft);
                    rowDiv.appendChild(spotRight);
                }

                grid.appendChild(rowDiv);
            });
        }

        function createSummaryPalletSpot(rowNumber, position) {
            const spot = document.createElement('div');
            const spotId = `${rowNumber}-${position}`;
            spot.className = 'pallet-spot';
            
            const pallet = loadedPallets[spotId];
            if (pallet) {
                spot.classList.add('filled');
                spot.innerHTML = `
                    <div class="pallet-id">${pallet.id}</div>
                    <div class="pallet-details">
                        ${pallet.variety}<br>
                        ${pallet.weight} LBS<br>
                        ${pallet.grade}<br>
                        ${pallet.bags} bags
                    </div>
                `;
            } else {
                spot.classList.add('empty');
                spot.innerHTML = `
                    <div class="position-label">Row ${rowNumber}<br>${position}</div>
                `;
            }

            return spot;
        }

        // ========== BARCODE SCANNING ==========
        function scanBarcode() {
            const input = document.getElementById('scanInput');
            const barcode = input.value.trim();
            const resultDiv = document.getElementById('scanResult');

            if (!barcode) {
                resultDiv.className = 'scan-result error';
                resultDiv.textContent = '‚ö†Ô∏è Please enter a barcode';
                resultDiv.style.display = 'block';
                return;
            }

            // Check for duplicate
            const isDuplicate = Object.values(loadedPallets).some(p => p.id === barcode);
            if (isDuplicate) {
                resultDiv.className = 'scan-result error';
                resultDiv.textContent = '‚ùå Duplicate pallet! This pallet is already loaded on the truck.';
                resultDiv.style.display = 'block';
                input.value = '';
                return;
            }

            // Success - show pallet prompts
            resultDiv.className = 'scan-result success';
            resultDiv.textContent = `‚úÖ Pallet scanned: ${barcode}`;
            resultDiv.style.display = 'block';

            currentPallet = {
                id: barcode,
                spotId: null
            };

            document.getElementById('palletPrompts').style.display = 'block';
            document.getElementById('palletVariety').value = '';
            document.getElementById('palletWeight').value = '';
            document.getElementById('palletGrade').value = '';
            document.getElementById('palletBags').value = '';
            
            // Highlight all empty spots
            highlightEmptySpots();

            input.value = '';
        }

        function highlightEmptySpots() {
            document.querySelectorAll('.pallet-spot.empty').forEach(spot => {
                spot.classList.add('selected');
            });
        }

        function placePallet(spotId) {
            if (!currentPallet) return;

            const variety = document.getElementById('palletVariety').value.trim();
            const weight = document.getElementById('palletWeight').value.trim();
            const grade = document.getElementById('palletGrade').value.trim();
            const bags = document.getElementById('palletBags').value.trim();

            if (!variety || !weight || !grade || !bags) {
                alert('Please fill in all pallet details');
                return;
            }

            // Save pallet
            loadedPallets[spotId] = {
                id: currentPallet.id,
                variety,
                weight,
                grade,
                bags,
                spotId
            };

            // Reset current pallet
            currentPallet = null;
            document.getElementById('palletPrompts').style.display = 'none';
            document.getElementById('scanResult').style.display = 'none';

            // Rebuild grid and update stats
            buildTruckGrid();
            updateStats();

            // Focus back on scan input
            document.getElementById('scanInput').focus();
        }

        // ========== STATISTICS ==========
        function updateStats() {
            const capacity = calculateTotalCapacity();
            const loaded = Object.keys(loadedPallets).length;
            const empty = capacity - loaded;
            let totalWeight = 0;

            Object.values(loadedPallets).forEach(pallet => {
                totalWeight += parseInt(pallet.weight) || 0;
            });

            document.getElementById('statLoaded').textContent = loaded;
            document.getElementById('statCapacity').textContent = capacity;
            document.getElementById('statEmpty').textContent = empty;
            document.getElementById('statWeight').textContent = totalWeight.toLocaleString();
        }

        function calculateTotalCapacity() {
            let capacity = 0;
            truckConfig.rows.forEach(row => {
                capacity += row.type === 'double' ? 2 : 1;
            });
            return capacity;
        }

        // ========== PO BARCODE ==========
        function generatePOBarcode() {
            const po = document.getElementById('customerPO').value.trim();
            const barcodeDiv = document.getElementById('poBarcode');

            if (!po) {
                barcodeDiv.style.display = 'none';
                return;
            }

            barcodeDiv.style.display = 'block';
            try {
                JsBarcode("#poBarcodeSVG", po, {
                    format: "CODE128",
                    width: 2,
                    height: 60,
                    displayValue: true
                });
            } catch (e) {
                console.error('Barcode generation error:', e);
                barcodeDiv.style.display = 'none';
            }
        }

        // ========== PALLET SUMMARY ==========
        function buildPalletSummaryList() {
            const listDiv = document.getElementById('palletSummaryList');
            
            const pallets = Object.values(loadedPallets);
            if (pallets.length === 0) {
                listDiv.innerHTML = '<p style="text-align: center; color: #6c757d;">No pallets loaded</p>';
                return;
            }

            listDiv.innerHTML = pallets.map(pallet => {
                const [row, position] = pallet.spotId.split('-');
                return `
                    <div class="pallet-summary-item">
                        <div class="pallet-summary-header">
                            ${pallet.id} - Row ${row} ${position}
                        </div>
                        <div class="pallet-summary-details">
                            <strong>Variety:</strong> ${pallet.variety} | 
                            <strong>Pack Weight:</strong> ${pallet.weight} LBS | 
                            <strong>Grade:</strong> ${pallet.grade} | 
                            <strong>Bags:</strong> ${pallet.bags} | 
                            <strong>Total Weight:</strong> ${(parseInt(pallet.weight) || 0).toLocaleString()} LBS
                        </div>
                    </div>
                `;
            }).join('');
        }
    </script>
</body>
</html>
